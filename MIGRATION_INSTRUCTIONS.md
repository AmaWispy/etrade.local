# –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ old_media

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø–æ–º–æ–∂–µ—Ç –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `old_media` –≤ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Laravel —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç—Ä–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

1. **`create_old_media_table.sql`** - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã old_media
2. **`migrate_old_media.php`** - Standalone PHP —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
3. **`app/Console/Commands/MigrateOldMedia.php`** - Laravel Artisan –∫–æ–º–∞–Ω–¥–∞
4. **`product_media_query.sql`** - SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã old_media (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç
mysql -u username -p database_name < create_old_media_table.sql
```

### 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã old_media
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `old_media` –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –≤–∞—à–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–∞–ø–∫–∞ `/storage/app/public/old-media/` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

## –°–ø–æ—Å–æ–±—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: Laravel Artisan –∫–æ–º–∞–Ω–¥–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É –≤ Laravel
php artisan list | grep migrate:old-media

# üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–ê –û–î–ù–û–ô –ó–ê–ü–ò–°–ò:
# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ)
php test_single_media.php

# –¢–µ—Å—Ç –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
php artisan migrate:old-media --test-one --dry-run

# –†–µ–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
php artisan migrate:old-media --test-one

# üöÄ –ü–û–õ–ù–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø:
# –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
php artisan migrate:old-media --dry-run

# –†–µ–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
php artisan migrate:old-media

# –ú–∏–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞
php artisan migrate:old-media --batch-size=100
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Standalone PHP —Å–∫—Ä–∏–ø—Ç

```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≤ —Ñ–∞–π–ª–µ migrate_old_media.php

# üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:
# –¢–µ—Å—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
php migrate_old_media.php --test-one

# üöÄ –ü–û–õ–ù–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø:
# –ú–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
php migrate_old_media.php
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–ß–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É old_media** - –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: jpg, jpeg, png, gif, webp, bmp, svg
3. **–ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ SKU** - —Å–≤—è–∑—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –≤ –ø–∞–ø–∫–µ `/storage/app/public/old-media/`
5. **–°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ media** - —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø—Ä–æ–¥—É–∫—Ç–∞–º
6. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**:
   - **thumb**: 100x100px (—Å –æ–±—Ä–µ–∑–∫–æ–π –∏ —Ä–µ–∑–∫–æ—Å—Ç—å—é)
   - **medium**: 400x400px (—Å –æ–±—Ä–µ–∑–∫–æ–π –∏ —Ä–µ–∑–∫–æ—Å—Ç—å—é)
   - **main**: 992x992px (fit max, –±–µ–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤)

**–í–∞–∂–Ω–æ**: –§–∞–π–ª—ã —Å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã, –Ω–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤

```
storage/app/public/
‚îú‚îÄ‚îÄ media/
‚îÇ   ‚îú‚îÄ‚îÄ [uuid].[ext]                    # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ conversions/
‚îÇ       ‚îú‚îÄ‚îÄ thumb/[media_id]/[file]     # –ú–∏–Ω–∏–∞—Ç—é—Ä—ã 100x100
‚îÇ       ‚îú‚îÄ‚îÄ medium/[media_id]/[file]    # –°—Ä–µ–¥–Ω–∏–µ 400x400
‚îÇ       ‚îî‚îÄ‚îÄ main/[media_id]/[file]      # –û—Å–Ω–æ–≤–Ω—ã–µ 992x992 (fit max)
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
```
File not found: example.jpg
```
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `/storage/app/public/old-media/`

### 2. –ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
```
Product not found for SKU: ABC123
```
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–¥—É–∫—Ç —Å —Ç–∞–∫–∏–º SKU —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `products`

### 3. –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```
Error creating thumb: ...
```
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ GD –∏–ª–∏ ImageMagick
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –ø–∞–ø–∫—É media
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: jpg, jpeg, png, gif, webp, bmp, svg)

### 4. –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞
```
Unsupported file format: file.tiff (.tiff)
```
**–†–µ—à–µ–Ω–∏–µ**: –§–∞–π–ª—ã —Å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã. –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏.

### 5. –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏
```
Fatal error: Allowed memory size exhausted
```
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–º–µ–Ω—å—à–∏—Ç–µ `--batch-size`
- –£–≤–µ–ª–∏—á—å—Ç–µ `memory_limit` –≤ PHP
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –ø–æ —á–∞—Å—Ç—è–º

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) FROM media WHERE collection_name = 'product-images';

-- –ó–∞–ø–∏—Å–∏ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º
SELECT m.*, p.sku, p.name 
FROM media m 
JOIN products p ON m.model_id = p.id 
WHERE m.model_type = 'App\\Models\\Shop\\Product' 
ORDER BY m.created_at DESC 
LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
SELECT file_name, generated_conversions 
FROM media 
WHERE collection_name = 'product-images' 
LIMIT 5;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ Filament –≤ —Ä–∞–∑–¥–µ–ª–µ Products.

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –º–µ–¥–∏–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
DELETE FROM media 
WHERE model_type = 'App\\Models\\Shop\\Product' 
AND collection_name = 'product-images';
```

```bash
# –£–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É —Å —Ñ–∞–π–ª–∞–º–∏
rm -rf storage/app/public/media/
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å. –î–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª:

```bash
php artisan migrate:old-media > migration.log 2>&1
``` 